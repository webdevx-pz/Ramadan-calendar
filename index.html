<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>মাশাআল্লাহ | রমাদান ক্যালেন্ডার ১৪৪৬</title>
    <!-- Font Awesome (আইকনের জন্য) ও Noto Sans Bengali ফন্ট -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Bengali', 'Segoe UI', sans-serif;
        }

        /* পটভূমি: অ্যানিমেটেড গ্রেডিয়েন্ট ও মৃদু ইসলামিক নকশা */
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f2b2b, #1c4e4e, #2a6b6b);
            background-size: 400% 400%;
            animation: gradientBG 18s ease infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ইসলামিক কলিগ্রাফির ব্যাকগ্রাউন্ড (অতি মৃদু) */
        body::before {
            content: "﷽";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 25vw;
            font-family: 'Traditional Arabic', 'Noto Naskh Arabic', serif;
            color: rgba(255, 255, 200, 0.03);
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
            user-select: none;
        }

        /* চাঁদ ও তারা ভাসমান */
        body::after {
            content: "☪";
            position: absolute;
            bottom: 10%;
            right: 5%;
            font-size: 15vw;
            color: rgba(255, 240, 180, 0.05);
            pointer-events: none;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        /* মূল কার্ড */
        .main-card {
            width: 100%;
            max-width: 1100px;
            background: rgba(15, 55, 55, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 215, 140, 0.3);
            border-radius: 64px;
            box-shadow: 0 35px 80px rgba(0, 20, 10, 0.5), inset 0 0 50px rgba(255, 235, 160, 0.2);
            padding: 36px 40px;
            color: #fcf0d5;
            transition: all 0.4s ease;
            z-index: 2;
            animation: fadeInUp 1.2s;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* হেডার - ইসলামিক বাণী */
        .islamic-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.9rem;
            font-weight: 500;
            background: rgba(255, 255, 240, 0.1);
            padding: 15px 20px;
            border-radius: 80px;
            border: 1px solid #f5d791;
            color: #faeac6;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }

        .islamic-header:hover {
            background: rgba(255, 240, 180, 0.2);
            border-color: #f8c150;
            transform: scale(1.02);
        }

        .islamic-header i {
            margin: 0 15px;
            color: #fecb6e;
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); text-shadow: 0 0 15px #ffb86b; }
            100% { opacity: 0.6; transform: scale(1); }
        }

        h2 {
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 10px 0 5px;
        }

        h2 i {
            color: #fbc85a;
            filter: drop-shadow(0 0 10px #f5b342);
            transition: 0.3s;
        }

        h2 i:hover {
            transform: rotate(15deg) scale(1.1);
        }

        .subhead {
            font-size: 1.1rem;
            opacity: 0.9;
            border-right: 2px solid #f7ce82;
            padding-right: 20px;
        }

        /* ফিল্টার */
        .filter-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0 25px;
            background: rgba(10, 45, 45, 0.5);
            border-radius: 60px;
            padding: 18px 26px;
            border: 1px solid #e0b469;
            transition: 0.4s;
        }

        .filter-area:hover {
            border-color: #f8cf8c;
            box-shadow: 0 0 20px #ffd58c80;
        }

        .filter-item {
            flex: 1 1 180px;
            transition: 0.3s;
        }

        .filter-item label {
            display: block;
            font-size: 0.95rem;
            color: #ffde94;
            letter-spacing: 1.2px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .filter-select {
            width: 100%;
            padding: 14px 22px;
            background: #1d504b;
            border: 2px solid #f3c960;
            border-radius: 50px;
            color: #fef5e1;
            font-size: 1.1rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23fad488" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>');
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 18px;
            transition: 0.3s;
        }

        .filter-select:hover {
            border-color: #ffd58c;
            background-color: #22645e;
            box-shadow: 0 5px 15px #ffd58c30;
            transform: translateY(-2px);
        }

        .filter-select option {
            background: #1f5550;
            color: #fffaec;
        }

        /* তারিখ বার */
        .date-time-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            background: rgba(8, 40, 40, 0.6);
            border-radius: 80px;
            padding: 16px 30px;
            margin-bottom: 20px;
            border: 1px solid #e6c27a;
            transition: 0.4s;
        }

        .date-time-bar:hover {
            border-color: #fad393;
            box-shadow: 0 0 30px #fad39360;
        }

        .date-item {
            display: flex;
            align-items: center;
            gap: 14px;
            background: rgba(0, 0, 0, 0.25);
            padding: 8px 24px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 500;
            transition: 0.3s;
        }

        .date-item:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: scale(1.02);
        }

        .date-item i {
            font-size: 1.9rem;
            color: #ffe1a3;
            transition: 0.3s;
        }

        .date-item:hover i {
            transform: rotate(5deg);
        }

        .live-clock {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(130deg, #ffb347, #ff8c42);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            text-shadow: 0 0 8px #ffa50080;
        }

        /* কাউন্টার সেকশন */
        .counters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 25px 0 20px;
        }

        .counter-card {
            flex: 1 1 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50px;
            padding: 18px 20px;
            border: 2px solid #fdcb6e;
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(8px);
            transition: 0.4s ease;
            cursor: pointer;
        }

        .counter-card:hover {
            border-color: #ffe59e;
            background: rgba(20, 60, 60, 0.7);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px #00000060, 0 0 30px #ffe087;
        }

        .counter-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
        }

        .counter-info i {
            font-size: 2rem;
            color: #ffd966;
            transition: 0.3s;
        }

        .counter-card:hover .counter-info i {
            transform: rotate(10deg) scale(1.1);
        }

        .counter-time {
            font-size: 1.9rem;
            font-weight: 700;
            background: #00000030;
            padding: 8px 18px;
            border-radius: 60px;
            border: 1px solid #febf5e;
            color: #fff7cf;
            letter-spacing: 2px;
            transition: 0.3s;
        }

        .counter-card:hover .counter-time {
            background: #00000050;
            border-color: #ffda88;
        }

        /* নামাজের গ্রিড */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 22px;
            margin-top: 20px;
        }

        .prayer-block {
            background: rgba(255, 250, 225, 0.08);
            border-radius: 40px;
            padding: 25px 10px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid #facf8f;
            transition: 0.4s ease;
            box-shadow: 0 10px 20px -5px #00000070;
            cursor: pointer;
        }

        .prayer-block.special {
            background: linear-gradient(145deg, #b7752a, #e09f4a);
            border-color: #ffe085;
        }

        .prayer-block:hover {
            transform: translateY(-10px) scale(1.02);
            background: rgba(110, 150, 140, 0.6);
            border-color: #ffe7a3;
            box-shadow: 0 20px 40px -5px #000, 0 0 30px #ffe68f;
        }

        .prayer-name {
            font-size: 1.7rem;
            font-weight: 650;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #f9ecc2;
        }

        .prayer-time {
            font-size: 2.3rem;
            font-weight: 700;
            text-shadow: 0 2px 15px #ffb763;
            color: #fff9e6;
            line-height: 1.3;
            transition: 0.3s;
        }

        .prayer-block:hover .prayer-time {
            text-shadow: 0 0 25px #ffdd96;
        }

        .prayer-note {
            font-size: 1rem;
            opacity: 0.8;
        }

        /* ইসলামিক উক্তি ফুটার */
        .dua-footer {
            margin-top: 40px;
            text-align: center;
            font-size: 1.2rem;
            background: rgba(255, 230, 160, 0.1);
            padding: 20px;
            border-radius: 60px;
            border: 1px solid #f5cf8c;
            transition: 0.4s;
            backdrop-filter: blur(8px);
        }

        .dua-footer:hover {
            background: rgba(255, 230, 160, 0.2);
            border-color: #fde3a8;
            box-shadow: 0 0 30px #fce1a8;
        }

        .dua-footer p {
            margin: 5px 0;
            font-weight: 500;
        }

        .dua-footer i {
            color: #ffd58c;
            margin: 0 10px;
        }

        /* স্ক্রোল অ্যানিমেশন (Intersection Observer দিয়ে ক্লাস যোগ হবে) */
        .fade-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .fade-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .loader {
            border: 5px solid #ffe6aa50;
            border-top: 5px solid #fdd28c;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        @keyframes spin { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }

        .error-box {
            background: #b64c4ce0;
            border-radius: 50px;
            padding: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        @media (max-width: 700px) {
            .main-card { padding: 20px; }
            h2 { font-size: 1.8rem; }
            .islamic-header { font-size: 1.4rem; }
            .date-time-bar { flex-direction: column; gap: 15px; }
            .counters-container { flex-direction: column; }
            .counter-card { flex-direction: column; gap: 10px; }
            .prayer-time { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="main-card">
        <!-- ইসলামিক হেডার -->
        <div class="islamic-header">
            <i class="fas fa-star"></i> 
            بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم 
            <i class="fas fa-star"></i>
        </div>

        <h2>
            <i class="fas fa-mosque"></i> 
            <span>রমাদান ১৪৪৬</span>
            <span class="subhead">সেহরি ও ইফতার নির্ঘণ্ট</span>
        </h2>

        <!-- ফিল্টার (অ্যানিমেটেড) -->
        <div class="filter-area fade-on-scroll">
            <div class="filter-item">
                <label for="division"><i class="fas fa-map"></i> বিভাগ</label>
                <select id="division" class="filter-select"></select>
            </div>
            <div class="filter-item">
                <label for="district"><i class="fas fa-building"></i> জেলা</label>
                <select id="district" class="filter-select" disabled></select>
            </div>
            <div class="filter-item">
                <label for="upazila"><i class="fas fa-location-dot"></i> উপজেলা (ঐচ্ছিক)</label>
                <select id="upazila" class="filter-select" disabled></select>
            </div>
        </div>

        <!-- তারিখ বার -->
        <div class="date-time-bar fade-on-scroll">
            <div class="date-item"><i class="fas fa-calendar-week"></i> <span id="englishDate">---</span></div>
            <div class="date-item"><i class="fas fa-calendar-alt"></i> <span id="bengaliDate">---</span></div>
            <div class="date-item"><i class="fas fa-moon"></i> <span id="hijriDate">---</span></div>
            <div class="date-item"><i class="fas fa-clock"></i> <span class="live-clock" id="liveClock">--:--:--</span></div>
        </div>

        <!-- কাউন্টার -->
        <div class="counters-container fade-on-scroll">
            <div class="counter-card">
                <div class="counter-info">
                    <i class="fas fa-mosque" id="nextGeneralIcon"></i>
                    <span id="nextGeneralName">পরবর্তী ওয়াক্ত</span>
                </div>
                <div class="counter-time" id="nextGeneralTime">--:--:--</div>
            </div>
            <div class="counter-card">
                <div class="counter-info">
                    <i class="fas fa-utensils" id="nextSpecialIcon"></i>
                    <span id="nextSpecialName">ইফতার/সেহরি</span>
                </div>
                <div class="counter-time" id="nextSpecialTime">--:--:--</div>
            </div>
        </div>

        <!-- নামাজের কার্ড -->
        <div id="prayerContainer" class="fade-on-scroll">
            <div class="loader"></div>
        </div>

        <!-- ইসলামিক ফুটার (দুআ) -->
        <div class="dua-footer fade-on-scroll">
            <i class="fas fa-heart"></i>
            <p>رَبَّنَا تَقَبَّلْ مِنَّا ۚ إِنَّكَ أَنْتَ السَّمِيعُ الْعَلِيمُ</p>
            <p>“হে আমাদের রব, আমাদের থেকে কবুল করুন। নিশ্চয় আপনি সর্বশ্রোতা, সর্বজ্ঞ।” (সূরা বাকারা ১২৭)</p>
            <i class="fas fa-heart"></i>
        </div>
    </div>

    <!-- স্ক্রোল অ্যানিমেশনের জন্য ছোট স্ক্রিপ্ট -->
    <script>
        // Intersection Observer - স্ক্রোল এলে ফেইড-ইন
        const faders = document.querySelectorAll('.fade-on-scroll');
        const appearOptions = { threshold: 0.2, rootMargin: '0px 0px -50px 0px' };
        const appearOnScroll = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target); // একবার দেখালেই হবে
                }
            });
        }, appearOptions);

        faders.forEach(fader => appearOnScroll.observe(fader));
    </script>

    <!-- মূল জাভাস্ক্রিপ্ট (আগের মত, শুধু অ্যাডের অংশ বাদ) -->
    <script>
        (function() {
            // ---------- বিভাগ ও জেলা ডেটা ----------
            const divisionsData = [
                { name: "ঢাকা", nameEn: "Dhaka", districts: [
                    { name: "ঢাকা", nameEn: "Dhaka" }, { name: "গাজীপুর", nameEn: "Gazipur" }, { name: "নারায়ণগঞ্জ", nameEn: "Narayanganj" },
                    { name: "টাঙ্গাইল", nameEn: "Tangail" }, { name: "ফরিদপুর", nameEn: "Faridpur" }, { name: "কিশোরগঞ্জ", nameEn: "Kishoreganj" },
                    { name: "মানিকগঞ্জ", nameEn: "Manikganj" }, { name: "মুন্সীগঞ্জ", nameEn: "Munshiganj" }, { name: "নরসিংদী", nameEn: "Narsingdi" },
                    { name: "রাজবাড়ী", nameEn: "Rajbari" }, { name: "শরীয়তপুর", nameEn: "Shariatpur" }, { name: "গোপালগঞ্জ", nameEn: "Gopalganj" },
                    { name: "মাদারীপুর", nameEn: "Madaripur" }
                ]},
                { name: "চট্টগ্রাম", nameEn: "Chittagong", districts: [
                    { name: "চট্টগ্রাম", nameEn: "Chittagong" }, { name: "কুমিল্লা", nameEn: "Comilla" }, { name: "চাঁদপুর", nameEn: "Chandpur" },
                    { name: "নোয়াখালী", nameEn: "Noakhali" }, { name: "ফেনী", nameEn: "Feni" }, { name: "লক্ষ্মীপুর", nameEn: "Lakshmipur" },
                    { name: "ব্রাহ্মণবাড়িয়া", nameEn: "Brahmanbaria" }, { name: "রাঙ্গামাটি", nameEn: "Rangamati" }, { name: "খাগড়াছড়ি", nameEn: "Khagrachhari" },
                    { name: "বান্দরবান", nameEn: "Bandarban" }, { name: "কক্সবাজার", nameEn: "Cox's Bazar" }
                ]},
                { name: "রাজশাহী", nameEn: "Rajshahi", districts: [
                    { name: "রাজশাহী", nameEn: "Rajshahi" }, { name: "বগুড়া", nameEn: "Bogura" }, { name: "পাবনা", nameEn: "Pabna" },
                    { name: "সিরাজগঞ্জ", nameEn: "Sirajganj" }, { name: "নাটোর", nameEn: "Natore" }, { name: "নওগাঁ", nameEn: "Naogaon" },
                    { name: "জয়পুরহাট", nameEn: "Joypurhat" }, { name: "চাঁপাইনবাবগঞ্জ", nameEn: "Chapainawabganj" }
                ]},
                { name: "খুলনা", nameEn: "Khulna", districts: [
                    { name: "খুলনা", nameEn: "Khulna" }, { name: "যশোর", nameEn: "Jessore" }, { name: "কুষ্টিয়া", nameEn: "Kushtia" },
                    { name: "মাগুরা", nameEn: "Magura" }, { name: "ঝিনাইদহ", nameEn: "Jhenaidah" }, { name: "চুয়াডাঙ্গা", nameEn: "Chuadanga" },
                    { name: "মেহেরপুর", nameEn: "Meherpur" }, { name: "নড়াইল", nameEn: "Narail" }, { name: "সাতক্ষীরা", nameEn: "Satkhira" },
                    { name: "বাগেরহাট", nameEn: "Bagerhat" }
                ]},
                { name: "বরিশাল", nameEn: "Barisal", districts: [
                    { name: "বরিশাল", nameEn: "Barisal" }, { name: "ভোলা", nameEn: "Bhola" }, { name: "পটুয়াখালী", nameEn: "Patuakhali" },
                    { name: "পিরোজপুর", nameEn: "Pirojpur" }, { name: "বরগুনা", nameEn: "Barguna" }, { name: "ঝালকাঠি", nameEn: "Jhalokati" }
                ]},
                { name: "সিলেট", nameEn: "Sylhet", districts: [
                    { name: "সিলেট", nameEn: "Sylhet" }, { name: "মৌলভীবাজার", nameEn: "Moulvibazar" }, { name: "হবিগঞ্জ", nameEn: "Habiganj" },
                    { name: "সুনামগঞ্জ", nameEn: "Sunamganj" }
                ]},
                { name: "রংপুর", nameEn: "Rangpur", districts: [
                    { name: "রংপুর", nameEn: "Rangpur" }, { name: "দিনাজপুর", nameEn: "Dinajpur" }, { name: "ঠাকুরগাঁও", nameEn: "Thakurgaon" },
                    { name: "পঞ্চগড়", nameEn: "Panchagarh" }, { name: "নীলফামারী", nameEn: "Nilphamari" }, { name: "লালমনিরহাট", nameEn: "Lalmonirhat" },
                    { name: "কুড়িগ্রাম", nameEn: "Kurigram" }, { name: "গাইবান্ধা", nameEn: "Gaibandha" }
                ]},
                { name: "ময়মনসিংহ", nameEn: "Mymensingh", districts: [
                    { name: "ময়মনসিংহ", nameEn: "Mymensingh" }, { name: "জামালপুর", nameEn: "Jamalpur" }, { name: "শেরপুর", nameEn: "Sherpur" },
                    { name: "নেত্রকোণা", nameEn: "Netrokona" }
                ]}
            ];

            // DOM এলিমেন্ট
            const divSelect = document.getElementById('division');
            const distSelect = document.getElementById('district');
            const upaSelect = document.getElementById('upazila');
            const prayerContainer = document.getElementById('prayerContainer');
            const englishSpan = document.getElementById('englishDate');
            const bengaliSpan = document.getElementById('bengaliDate');
            const hijriSpan = document.getElementById('hijriDate');
            const clockSpan = document.getElementById('liveClock');
            const nextGeneralName = document.getElementById('nextGeneralName');
            const nextGeneralTime = document.getElementById('nextGeneralTime');
            const nextGeneralIcon = document.getElementById('nextGeneralIcon');
            const nextSpecialName = document.getElementById('nextSpecialName');
            const nextSpecialTime = document.getElementById('nextSpecialTime');
            const nextSpecialIcon = document.getElementById('nextSpecialIcon');

            let currentTimings = null;

            // বিভাগ পূর্ণ করা
            divisionsData.forEach((div, idx) => {
                const opt = document.createElement('option');
                opt.value = div.nameEn;
                opt.textContent = div.name;
                opt.dataset.index = idx;
                divSelect.appendChild(opt);
            });

            divSelect.addEventListener('change', function() {
                const idx = this.selectedOptions[0]?.dataset.index;
                distSelect.innerHTML = '<option value="">জেলা নির্বাচন করুন</option>';
                distSelect.disabled = true;
                upaSelect.innerHTML = '<option value="">প্রথমে জেলা নির্বাচন</option>';
                upaSelect.disabled = true;
                if (idx === undefined) return;

                const districts = divisionsData[idx].districts;
                districts.forEach((dist, dIdx) => {
                    const opt = document.createElement('option');
                    opt.value = dist.nameEn;
                    opt.textContent = dist.name;
                    opt.dataset.distIndex = dIdx;
                    distSelect.appendChild(opt);
                });
                distSelect.disabled = false;
            });

            distSelect.addEventListener('change', function() {
                upaSelect.innerHTML = '<option value="">যেকোনো (ঐচ্ছিক)</option>';
                upaSelect.disabled = false;
                if (distSelect.value) fetchPrayerTimes(distSelect.value);
            });

            upaSelect.addEventListener('change', function() {
                if (distSelect.value) fetchPrayerTimes(distSelect.value);
            });

            // ঘড়ি আপডেট
            function updateClock() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
                clockSpan.textContent = timeStr;
            }
            setInterval(updateClock, 1000);
            updateClock();

            // তারিখ ফরম্যাট
            function formatEnglishDate(date) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('bn-BD', options);
            }
            function getBengaliDate(date) {
                const start = new Date(date.getFullYear(), 3, 14);
                if (date < start) start.setFullYear(date.getFullYear() - 1);
                const diff = Math.floor((date - start) / (864e5));
                const months = ['বৈশাখ', 'জ্যৈষ্ঠ', 'আষাঢ়', 'শ্রাবণ', 'ভাদ্র', 'আশ্বিন', 'কার্তিক', 'অগ্রহায়ণ', 'পৌষ', 'মাঘ', 'ফাল্গুন', 'চৈত্র'];
                let month = Math.floor(diff / 30);
                if (month > 11) month = 11;
                const day = (diff % 30) + 1;
                const year = date.getFullYear() - 593;
                return `${day} ${months[month]} ${year}`;
            }

            function updateDateDisplay(hijriStr) {
                const now = new Date();
                englishSpan.textContent = formatEnglishDate(now);
                bengaliSpan.textContent = getBengaliDate(now);
                if (hijriStr) hijriSpan.textContent = hijriStr;
                else hijriSpan.textContent = "— রমাদান ১৪৪৬";
            }

            // কাউন্টার আপডেট
            function updateCounters() {
                if (!currentTimings) {
                    nextGeneralTime.textContent = "--:--:--";
                    nextSpecialTime.textContent = "--:--:--";
                    return;
                }

                const now = new Date();
                const entries = [
                    { name: 'সেহরি', timeStr: currentTimings.Imsak, special: true },
                    { name: 'ফজর', timeStr: currentTimings.Fajr, special: false },
                    { name: 'যোহর', timeStr: currentTimings.Dhuhr, special: false },
                    { name: 'আসর', timeStr: currentTimings.Asr, special: false },
                    { name: 'ইফতার', timeStr: currentTimings.Maghrib, special: true },
                    { name: 'ইশা', timeStr: currentTimings.Isha, special: false }
                ];

                const prayerTimes = entries.map(e => {
                    const [hour, minute] = e.timeStr.split(':').map(Number);
                    const date = new Date(now);
                    date.setHours(hour, minute, 0, 0);
                    return { name: e.name, time: date, special: e.special };
                });

                let nextGeneral = null;
                for (let p of prayerTimes) {
                    if (p.time > now) { nextGeneral = p; break; }
                }
                if (!nextGeneral) {
                    const imsakToday = prayerTimes.find(p => p.name === 'সেহরি').time;
                    const tomorrowSehri = new Date(imsakToday.getTime() + 24*60*60*1000);
                    nextGeneral = { name: 'আগামীকাল সেহরি', time: tomorrowSehri, special: true };
                }

                let nextSpecial = null;
                for (let p of prayerTimes) {
                    if (p.special && p.time > now) { nextSpecial = p; break; }
                }
                if (!nextSpecial) {
                    const imsakToday = prayerTimes.find(p => p.name === 'সেহরি').time;
                    const tomorrowSehri = new Date(imsakToday.getTime() + 24*60*60*1000);
                    nextSpecial = { name: 'আগামীকাল সেহরি', time: tomorrowSehri, special: true };
                }

                function formatDiff(ms) {
                    if (ms <= 0) return "00:00:00";
                    const hours = Math.floor(ms / (1000*60*60));
                    const minutes = Math.floor((ms % (1000*60*60)) / (1000*60));
                    const seconds = Math.floor((ms % (1000*60)) / 1000);
                    return `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                }

                nextGeneralTime.textContent = formatDiff(nextGeneral.time - now);
                if (nextGeneral.name.includes('সেহরি')) {
                    nextGeneralIcon.className = 'fas fa-utensils';
                    nextGeneralName.textContent = nextGeneral.name + (nextGeneral.name.includes('আগামীকাল') ? '' : ' শুরু হতে');
                } else if (nextGeneral.name.includes('ইফতার')) {
                    nextGeneralIcon.className = 'fas fa-sunset';
                    nextGeneralName.textContent = nextGeneral.name + ' শুরু হতে';
                } else {
                    nextGeneralIcon.className = 'fas fa-mosque';
                    nextGeneralName.textContent = nextGeneral.name + ' শুরু হতে';
                }

                nextSpecialTime.textContent = formatDiff(nextSpecial.time - now);
                if (nextSpecial.name.includes('সেহরি')) {
                    nextSpecialIcon.className = 'fas fa-utensils';
                    nextSpecialName.textContent = nextSpecial.name + (nextSpecial.name.includes('আগামীকাল') ? '' : ' শুরু হতে');
                } else {
                    nextSpecialIcon.className = 'fas fa-sunset';
                    nextSpecialName.textContent = nextSpecial.name + ' শুরু হতে';
                }
            }

            // API কল (হানাফী)
            async function fetchPrayerTimes(cityEn) {
                prayerContainer.innerHTML = `<div class="loader"></div>`;
                const today = new Date();
                const dateStr = `${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}`;
                const url = `https://api.aladhan.com/v1/timingsByCity/${dateStr}?city=${encodeURIComponent(cityEn)}&country=Bangladesh&method=1&school=1`;

                try {
                    const resp = await fetch(url);
                    const data = await resp.json();
                    if (data.code !== 200) throw new Error('Invalid response');

                    const t = data.data.timings;
                    const hijri = data.data.date.hijri;
                    const hijriStr = `${hijri.day} ${hijri.month.en} ${hijri.year}`;
                    updateDateDisplay(hijriStr);

                    currentTimings = t;

                    const items = [
                        { name: 'সেহরি', time: t.Imsak, icon: 'fa-utensils', special: true },
                        { name: 'ফজর', time: t.Fajr, icon: 'fa-sun', special: false },
                        { name: 'যোহর', time: t.Dhuhr, icon: 'fa-sun', special: false },
                        { name: 'আসর', time: t.Asr, icon: 'fa-cloud-sun', special: false },
                        { name: 'ইফতার', time: t.Maghrib, icon: 'fa-sunset', special: true },
                        { name: 'ইশা', time: t.Isha, icon: 'fa-moon', special: false }
                    ];

                    let html = '<div class="prayer-grid">';
                    items.forEach(it => {
                        html += `<div class="prayer-block ${it.special ? 'special' : ''}">
                            <div class="prayer-name"><i class="fas ${it.icon}"></i> ${it.name}</div>
                            <div class="prayer-time">${it.time}</div>
                            <div class="prayer-note">${it.special ? (it.name === 'সেহরি' ? 'রোজা শুরুর শেষ সময়' : 'ইফতারের সময়') : ''}</div>
                        </div>`;
                    });
                    html += '</div>';
                    prayerContainer.innerHTML = html;

                    if (window.counterInterval) clearInterval(window.counterInterval);
                    updateCounters();
                    window.counterInterval = setInterval(updateCounters, 1000);

                } catch (err) {
                    prayerContainer.innerHTML = `<div class="error-box"><i class="fas fa-exclamation-triangle"></i> সময় লোড হয়নি, জেলা সঠিক আছে কি?</div>`;
                    console.warn(err);
                    updateDateDisplay(null);
                    currentTimings = null;
                }
            }

            // প্রথম লোড
            window.addEventListener('load', function() {
                divSelect.value = 'Dhaka';
                divSelect.dispatchEvent(new Event('change'));
                setTimeout(() => {
                    distSelect.value = 'Dhaka';
                    distSelect.dispatchEvent(new Event('change'));
                }, 300);
            });
        })();
    </script>
</body>
</html>
