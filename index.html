<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>রমাদান ক্যালেন্ডার | ইফতার-সেহরি ও নামাজের সময়</title>
    <!-- Font Awesome & Google Fonts (Noto Sans Bengali) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        body {
            background: linear-gradient(145deg, #0e3b3b 0%, #1b5e5e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        body::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M20 30 L30 20 L40 30 L50 20 L60 30 L70 20 L80 30 L70 40 L80 50 L70 60 L80 70 L70 80 L60 70 L50 80 L40 70 L30 80 L20 70 L30 60 L20 50 L30 40 L20 30" fill="%23f9e4b7" stroke="%23f9e4b7" stroke-width="0.5"/></svg>') repeat;
            pointer-events: none;
        }
        .main-card {
            width: 100%;
            max-width: 1100px;
            background: rgba(20, 65, 65, 0.65);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: 2px solid rgba(255, 220, 150, 0.4);
            border-radius: 56px;
            box-shadow: 0 35px 70px -10px rgba(0, 30, 30, 0.7), inset 0 0 60px rgba(250, 235, 170, 0.2);
            padding: 32px 36px;
            color: #fcf3dc;
            transition: 0.3s;
            z-index: 2;
        }
        h2 {
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        h2 i {
            color: #facc6f;
            filter: drop-shadow(0 0 6px #f0b848);
        }
        .subhead {
            font-size: 1.1rem;
            opacity: 0.85;
            font-weight: 400;
            border-left: 3px solid #eac586;
            padding-left: 16px;
        }
        /* ফিল্টার */
        .filter-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0 20px 0;
            background: rgba(15, 55, 50, 0.7);
            border-radius: 60px;
            padding: 18px 26px;
            border: 1px solid #e5b75f;
        }
        .filter-item {
            flex: 1 1 180px;
        }
        .filter-item label {
            display: block;
            font-size: 0.95rem;
            color: #ffde94;
            letter-spacing: 1.2px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        .filter-select {
            width: 100%;
            padding: 14px 22px;
            background: #1e504b;
            border: 2px solid #f3c960;
            border-radius: 50px;
            color: #fef5e1;
            font-size: 1.1rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23fad488" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>');
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 18px;
        }
        .filter-select option {
            background: #1f5550;
            color: #fffaec;
        }
        .filter-select:disabled {
            opacity: 0.7;
            border-color: #b9995a;
        }
        /* তারিখ বার */
        .date-time-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 45, 45, 0.7);
            border-radius: 80px;
            padding: 16px 30px;
            margin-bottom: 20px;
            border: 1px solid #e6c27a;
            box-shadow: 0 6px 14px rgba(0,0,0,0.4);
        }
        .date-item {
            display: flex;
            align-items: center;
            gap: 14px;
            background: rgba(0, 0, 0, 0.25);
            padding: 8px 24px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 500;
        }
        .date-item i {
            font-size: 1.9rem;
            color: #ffe1a3;
        }
        .live-clock {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(130deg, #ffb347, #ff8c42);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            text-shadow: 0 0 8px #ffa50080;
        }
        /* কাউন্টার সেকশন */
        .counters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 25px 0 20px 0;
        }
        .counter-card {
            flex: 1 1 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50px;
            padding: 18px 20px;
            border: 2px solid #fdcb6e;
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(8px);
        }
        .counter-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
        }
        .counter-info i {
            font-size: 2rem;
            color: #ffd966;
        }
        .counter-time {
            font-size: 1.9rem;
            font-weight: 700;
            background: #00000030;
            padding: 8px 18px;
            border-radius: 60px;
            border: 1px solid #febf5e;
            color: #fff7cf;
            letter-spacing: 2px;
        }
        /* নামাজের গ্রিড */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 22px;
            margin-top: 20px;
        }
        .prayer-block {
            background: rgba(255, 250, 225, 0.08);
            border-radius: 40px;
            padding: 25px 10px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid #facf8f;
            transition: 0.25s;
            box-shadow: 0 10px 20px -5px #00000070;
        }
        .prayer-block.special {
            background: linear-gradient(145deg, #b7752a, #e09f4a);
            border-color: #ffe085;
        }
        .prayer-block.special .prayer-name {
            color: #1d3b30;
        }
        .prayer-block:hover {
            transform: scale(1.02);
            background: rgba(90, 130, 120, 0.5);
            border-color: #feda9b;
        }
        .prayer-name {
            font-size: 1.7rem;
            font-weight: 650;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #f9ecc2;
        }
        .prayer-time {
            font-size: 2.3rem;
            font-weight: 700;
            text-shadow: 0 2px 15px #ffb763;
            color: #fff9e6;
            line-height: 1.3;
        }
        .prayer-note {
            font-size: 1rem;
            opacity: 0.8;
        }
        /* অ্যাডের জন্য কিছু স্টাইল */
        .ad-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            text-align: center;
            overflow: hidden;
        }
        .ad-banner {
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            padding: 5px;
        }
        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9rem;
            border-top: 2px dotted #b38945;
            padding-top: 20px;
            opacity: 0.9;
        }
        .loader {
            border: 5px solid #ffe6aa50;
            border-top: 5px solid #fdd28c;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        @keyframes spin { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }
        .error-box {
            background: #b64c4ce0;
            border-radius: 50px;
            padding: 20px;
            font-size: 1.3rem;
            text-align: center;
        }
        @media (max-width: 700px) {
            .main-card { padding: 18px; }
            h2 { font-size: 1.8rem; }
            .date-time-bar { flex-direction: column; gap: 15px; }
            .counters-container { flex-direction: column; }
            .counter-card { flex-direction: column; gap: 10px; }
            .prayer-time { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
<div class="main-card">
    <h2>
        <i class="fas fa-star-and-crescent"></i> 
        <span>রমাদান ১৪৪৬</span>
        <span class="subhead">সেহরি ও ইফতার নির্ঘণ্ট</span>
    </h2>

    <!-- ==================== ফিল্টার ==================== -->
    <div class="filter-area">
        <div class="filter-item">
            <label for="division"><i class="fas fa-map"></i> বিভাগ</label>
            <select id="division" class="filter-select"></select>
        </div>
        <div class="filter-item">
            <label for="district"><i class="fas fa-building"></i> জেলা</label>
            <select id="district" class="filter-select" disabled></select>
        </div>
        <div class="filter-item">
            <label for="upazila"><i class="fas fa-location-dot"></i> উপজেলা (ঐচ্ছিক)</label>
            <select id="upazila" class="filter-select" disabled></select>
        </div>
    </div>

    <!-- ==================== তারিখ বার ==================== -->
    <div class="date-time-bar">
        <div class="date-item"><i class="fas fa-calendar-week"></i> <span id="englishDate">---</span></div>
        <div class="date-item"><i class="fas fa-calendar-alt"></i> <span id="bengaliDate">---</span></div>
        <div class="date-item"><i class="fas fa-moon"></i> <span id="hijriDate">---</span></div>
        <div class="date-item"><i class="fas fa-clock"></i> <span class="live-clock" id="liveClock">--:--:--</span></div>
    </div>

    <!-- ==================== প্রথম অ্যাড (নেটিভ/ডিসপ্লে) ==================== -->
    <!-- Adsterra native/display ad (container) -->
    <div class="ad-container">
        <div id="container-8f4723e805f212f75402ca0f37f2cd9c"></div>
    </div>
    <script async="async" data-cfasync="false" src="https://pl28738268.effectivegatecpm.com/8f4723e805f212f75402ca0f37f2cd9c/invoke.js"></script>

    <!-- ==================== দ্বিতীয় অ্যাড (468x60) ==================== -->
    <!-- 468x60 iframe ad -->
    <div class="ad-container ad-banner">
        <script>
          atOptions = {
            'key' : '3839b0251fde4fe301bdfcb9140cfc75',
            'format' : 'iframe',
            'height' : 60,
            'width' : 468,
            'params' : {}
          };
        </script>
        <script src="https://www.highperformanceformat.com/3839b0251fde4fe301bdfcb9140cfc75/invoke.js"></script>
    </div>

    <!-- ==================== কাউন্টার ==================== -->
    <div class="counters-container">
        <!-- সাধারণ পরবর্তী ওয়াক্ত কাউন্টার -->
        <div class="counter-card">
            <div class="counter-info">
                <i class="fas fa-mosque" id="nextGeneralIcon"></i>
                <span id="nextGeneralName">পরবর্তী ওয়াক্ত</span>
            </div>
            <div class="counter-time" id="nextGeneralTime">--:--:--</div>
        </div>
        <!-- শুধু ইফতার/সেহরি কাউন্টার -->
        <div class="counter-card">
            <div class="counter-info">
                <i class="fas fa-utensils" id="nextSpecialIcon"></i>
                <span id="nextSpecialName">ইফতার/সেহরি</span>
            </div>
            <div class="counter-time" id="nextSpecialTime">--:--:--</div>
        </div>
    </div>

    <!-- ==================== তৃতীয় অ্যাড (300x250) ==================== -->
    <!-- 300x250 iframe ad -->
    <div class="ad-container">
        <script>
          atOptions = {
            'key' : 'fe44a54f0b6cd72047e227dd26f05433',
            'format' : 'iframe',
            'height' : 250,
            'width' : 300,
            'params' : {}
          };
        </script>
        <script src="https://www.highperformanceformat.com/fe44a54f0b6cd72047e227dd26f05433/invoke.js"></script>
    </div>

    <!-- ==================== নামাজের গ্রিড ==================== -->
    <div id="prayerContainer">
        <div class="loader"></div>
    </div>

    <!-- ==================== চতুর্থ অ্যাড (728x90) ==================== -->
    <!-- 728x90 iframe ad placed before footer -->
    <div class="ad-container">
        <script>
          atOptions = {
            'key' : '7a997e5d26f7ca72fe03307d3f8695d2',
            'format' : 'iframe',
            'height' : 90,
            'width' : 728,
            'params' : {}
          };
        </script>
        <script src="https://www.highperformanceformat.com/7a997e5d26f7ca72fe03307d3f8695d2/invoke.js"></script>
    </div>

    <!-- ==================== ফুটার ==================== -->
    <footer>
        ⏱ ইসলামিক ফাউন্ডেশন বাংলাদেশ (হানাফী) • সকল জেলার জন্য নির্ভুল • DEVELOPED BY ❤️ PARV3Z
    </footer>
</div>

<!-- ==================== সোশ্যাল বার (স্টিকি) ==================== -->
<!-- Adsterra social bar script (sticky) – এটি body-র একদম শেষে বসবে -->
<script src="https://pl28738291.effectivegatecpm.com/d0/e4/34/d0e434db993909843ab6932d643e85d4.js"></script>

<!-- ==================== আপনার বিদ্যমান কাস্টম স্ক্রিপ্ট ==================== -->
<script>
(function() {
    // ------------------------ বিভাগ ও জেলা ডেটা (সমস্ত জেলা) -------------------------
    const divisionsData = [
        { name: "ঢাকা", nameEn: "Dhaka", districts: [
            { name: "ঢাকা", nameEn: "Dhaka" }, { name: "গাজীপুর", nameEn: "Gazipur" }, { name: "নারায়ণগঞ্জ", nameEn: "Narayanganj" },
            { name: "টাঙ্গাইল", nameEn: "Tangail" }, { name: "ফরিদপুর", nameEn: "Faridpur" }, { name: "কিশোরগঞ্জ", nameEn: "Kishoreganj" },
            { name: "মানিকগঞ্জ", nameEn: "Manikganj" }, { name: "মুন্সীগঞ্জ", nameEn: "Munshiganj" }, { name: "নরসিংদী", nameEn: "Narsingdi" },
            { name: "রাজবাড়ী", nameEn: "Rajbari" }, { name: "শরীয়তপুর", nameEn: "Shariatpur" }, { name: "গোপালগঞ্জ", nameEn: "Gopalganj" },
            { name: "মাদারীপুর", nameEn: "Madaripur" }
        ]},
        { name: "চট্টগ্রাম", nameEn: "Chittagong", districts: [
            { name: "চট্টগ্রাম", nameEn: "Chittagong" }, { name: "কুমিল্লা", nameEn: "Comilla" }, { name: "চাঁদপুর", nameEn: "Chandpur" },
            { name: "নোয়াখালী", nameEn: "Noakhali" }, { name: "ফেনী", nameEn: "Feni" }, { name: "লক্ষ্মীপুর", nameEn: "Lakshmipur" },
            { name: "ব্রাহ্মণবাড়িয়া", nameEn: "Brahmanbaria" }, { name: "রাঙ্গামাটি", nameEn: "Rangamati" }, { name: "খাগড়াছড়ি", nameEn: "Khagrachhari" },
            { name: "বান্দরবান", nameEn: "Bandarban" }, { name: "কক্সবাজার", nameEn: "Cox's Bazar" }
        ]},
        { name: "রাজশাহী", nameEn: "Rajshahi", districts: [
            { name: "রাজশাহী", nameEn: "Rajshahi" }, { name: "বগুড়া", nameEn: "Bogura" }, { name: "পাবনা", nameEn: "Pabna" },
            { name: "সিরাজগঞ্জ", nameEn: "Sirajganj" }, { name: "নাটোর", nameEn: "Natore" }, { name: "নওগাঁ", nameEn: "Naogaon" },
            { name: "জয়পুরহাট", nameEn: "Joypurhat" }, { name: "চাঁপাইনবাবগঞ্জ", nameEn: "Chapainawabganj" }
        ]},
        { name: "খুলনা", nameEn: "Khulna", districts: [
            { name: "খুলনা", nameEn: "Khulna" }, { name: "যশোর", nameEn: "Jessore" }, { name: "কুষ্টিয়া", nameEn: "Kushtia" },
            { name: "মাগুরা", nameEn: "Magura" }, { name: "ঝিনাইদহ", nameEn: "Jhenaidah" }, { name: "চুয়াডাঙ্গা", nameEn: "Chuadanga" },
            { name: "মেহেরপুর", nameEn: "Meherpur" }, { name: "নড়াইল", nameEn: "Narail" }, { name: "সাতক্ষীরা", nameEn: "Satkhira" },
            { name: "বাগেরহাট", nameEn: "Bagerhat" }
        ]},
        { name: "বরিশাল", nameEn: "Barisal", districts: [
            { name: "বরিশাল", nameEn: "Barisal" }, { name: "ভোলা", nameEn: "Bhola" }, { name: "পটুয়াখালী", nameEn: "Patuakhali" },
            { name: "পিরোজপুর", nameEn: "Pirojpur" }, { name: "বরগুনা", nameEn: "Barguna" }, { name: "ঝালকাঠি", nameEn: "Jhalokati" }
        ]},
        { name: "সিলেট", nameEn: "Sylhet", districts: [
            { name: "সিলেট", nameEn: "Sylhet" }, { name: "মৌলভীবাজার", nameEn: "Moulvibazar" }, { name: "হবিগঞ্জ", nameEn: "Habiganj" },
            { name: "সুনামগঞ্জ", nameEn: "Sunamganj" }
        ]},
        { name: "রংপুর", nameEn: "Rangpur", districts: [
            { name: "রংপুর", nameEn: "Rangpur" }, { name: "দিনাজপুর", nameEn: "Dinajpur" }, { name: "ঠাকুরগাঁও", nameEn: "Thakurgaon" },
            { name: "পঞ্চগড়", nameEn: "Panchagarh" }, { name: "নীলফামারী", nameEn: "Nilphamari" }, { name: "লালমনিরহাট", nameEn: "Lalmonirhat" },
            { name: "কুড়িগ্রাম", nameEn: "Kurigram" }, { name: "গাইবান্ধা", nameEn: "Gaibandha" }
        ]},
        { name: "ময়মনসিংহ", nameEn: "Mymensingh", districts: [
            { name: "ময়মনসিংহ", nameEn: "Mymensingh" }, { name: "জামালপুর", nameEn: "Jamalpur" }, { name: "শেরপুর", nameEn: "Sherpur" },
            { name: "নেত্রকোণা", nameEn: "Netrokona" }
        ]}
    ];

    // DOM elements
    const divSelect = document.getElementById('division');
    const distSelect = document.getElementById('district');
    const upaSelect = document.getElementById('upazila');
    const prayerContainer = document.getElementById('prayerContainer');
    const englishSpan = document.getElementById('englishDate');
    const bengaliSpan = document.getElementById('bengaliDate');
    const hijriSpan = document.getElementById('hijriDate');
    const clockSpan = document.getElementById('liveClock');
    // General counter
    const nextGeneralName = document.getElementById('nextGeneralName');
    const nextGeneralTime = document.getElementById('nextGeneralTime');
    const nextGeneralIcon = document.getElementById('nextGeneralIcon');
    // Special counter (only iftar/sehr)
    const nextSpecialName = document.getElementById('nextSpecialName');
    const nextSpecialTime = document.getElementById('nextSpecialTime');
    const nextSpecialIcon = document.getElementById('nextSpecialIcon');

    let currentTimings = null;

    // populate divisions
    divisionsData.forEach((div, idx) => {
        const opt = document.createElement('option');
        opt.value = div.nameEn;
        opt.textContent = div.name;
        opt.dataset.index = idx;
        divSelect.appendChild(opt);
    });

    divSelect.addEventListener('change', function() {
        const idx = this.selectedOptions[0]?.dataset.index;
        distSelect.innerHTML = '<option value="">জেলা নির্বাচন করুন</option>';
        distSelect.disabled = true;
        upaSelect.innerHTML = '<option value="">প্রথমে জেলা নির্বাচন</option>';
        upaSelect.disabled = true;
        if (idx === undefined) return;

        const districts = divisionsData[idx].districts;
        districts.forEach((dist, dIdx) => {
            const opt = document.createElement('option');
            opt.value = dist.nameEn;
            opt.textContent = dist.name;
            opt.dataset.distIndex = dIdx;
            distSelect.appendChild(opt);
        });
        distSelect.disabled = false;
    });

    distSelect.addEventListener('change', function() {
        upaSelect.innerHTML = '<option value="">যেকোনো (ঐচ্ছিক)</option>';
        upaSelect.disabled = false;
        if (distSelect.value) fetchPrayerTimes(distSelect.value);
    });

    upaSelect.addEventListener('change', function() {
        if (distSelect.value) fetchPrayerTimes(distSelect.value);
    });

    // Clock update
    function updateClock() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
        clockSpan.textContent = timeStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Date formatting
    function formatEnglishDate(date) {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('bn-BD', options);
    }
    function getBengaliDate(date) {
        const start = new Date(date.getFullYear(), 3, 14);
        if (date < start) start.setFullYear(date.getFullYear() - 1);
        const diff = Math.floor((date - start) / (864e5));
        const months = ['বৈশাখ', 'জ্যৈষ্ঠ', 'আষাঢ়', 'শ্রাবণ', 'ভাদ্র', 'আশ্বিন', 'কার্তিক', 'অগ্রহায়ণ', 'পৌষ', 'মাঘ', 'ফাল্গুন', 'চৈত্র'];
        let month = Math.floor(diff / 30);
        if (month > 11) month = 11;
        const day = (diff % 30) + 1;
        const year = date.getFullYear() - 593;
        return `${day} ${months[month]} ${year}`;
    }

    function updateDateDisplay(hijriStr) {
        const now = new Date();
        englishSpan.textContent = formatEnglishDate(now);
        bengaliSpan.textContent = getBengaliDate(now);
        if (hijriStr) hijriSpan.textContent = hijriStr;
        else hijriSpan.textContent = "— রমাদান ১৪৪৬";
    }

    // কাউন্টার আপডেট ফাংশন (উভয় কাউন্টারের জন্য)
    function updateCounters() {
        if (!currentTimings) {
            nextGeneralTime.textContent = "--:--:--";
            nextSpecialTime.textContent = "--:--:--";
            return;
        }

        const now = new Date();

        // সময়ের তালিকা তৈরি (Imsak, Fajr, Dhuhr, Asr, Maghrib, Isha)
        const entries = [
            { name: 'সেহরি', timeStr: currentTimings.Imsak, special: true },
            { name: 'ফজর', timeStr: currentTimings.Fajr, special: false },
            { name: 'যোহর', timeStr: currentTimings.Dhuhr, special: false },
            { name: 'আসর', timeStr: currentTimings.Asr, special: false },
            { name: 'ইফতার', timeStr: currentTimings.Maghrib, special: true },
            { name: 'ইশা', timeStr: currentTimings.Isha, special: false }
        ];

        // প্রতিটি ওয়াক্তের Date object তৈরি
        const prayerTimes = entries.map(e => {
            const [hour, minute] = e.timeStr.split(':').map(Number);
            const date = new Date(now);
            date.setHours(hour, minute, 0, 0);
            return { name: e.name, time: date, special: e.special };
        });

        // পরবর্তী সাধারণ ওয়াক্ত খুঁজি (যে কোনো)
        let nextGeneral = null;
        for (let p of prayerTimes) {
            if (p.time > now) {
                nextGeneral = p;
                break;
            }
        }
        // যদি না পাওয়া যায় (সব পেরিয়ে গেছে), আগামীকালের সেহরি
        if (!nextGeneral) {
            const imsakToday = prayerTimes.find(p => p.name === 'সেহরি').time;
            const tomorrowSehri = new Date(imsakToday.getTime() + 24*60*60*1000);
            nextGeneral = {
                name: 'আগামীকাল সেহরি',
                time: tomorrowSehri,
                special: true
            };
        }

        // পরবর্তী স্পেশাল (ইফতার/সেহরি) ইভেন্ট
        let nextSpecial = null;
        for (let p of prayerTimes) {
            if (p.special && p.time > now) {
                nextSpecial = p;
                break;
            }
        }
        if (!nextSpecial) {
            // স্পেশাল ইভেন্ট না পেলে আগামীকালের সেহরি (যা স্পেশাল)
            const imsakToday = prayerTimes.find(p => p.name === 'সেহরি').time;
            const tomorrowSehri = new Date(imsakToday.getTime() + 24*60*60*1000);
            nextSpecial = {
                name: 'আগামীকাল সেহরি',
                time: tomorrowSehri,
                special: true
            };
        }

        // বাকি সময় গণনা (hh:mm:ss)
        function formatDiff(ms) {
            if (ms <= 0) return "00:00:00";
            const hours = Math.floor(ms / (1000*60*60));
            const minutes = Math.floor((ms % (1000*60*60)) / (1000*60));
            const seconds = Math.floor((ms % (1000*60)) / 1000);
            return `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
        }

        const diffGeneral = nextGeneral.time - now;
        const diffSpecial = nextSpecial.time - now;

        nextGeneralTime.textContent = formatDiff(diffGeneral);
        // সাধারণ কাউন্টারের নাম ও আইকন
        if (nextGeneral.name.includes('সেহরি')) {
            nextGeneralIcon.className = 'fas fa-utensils';
            nextGeneralName.textContent = nextGeneral.name + (nextGeneral.name.includes('আগামীকাল') ? '' : ' শুরু হতে');
        } else if (nextGeneral.name.includes('ইফতার')) {
            nextGeneralIcon.className = 'fas fa-sunset';
            nextGeneralName.textContent = nextGeneral.name + ' শুরু হতে';
        } else {
            nextGeneralIcon.className = 'fas fa-mosque';
            nextGeneralName.textContent = nextGeneral.name + ' শুরু হতে';
        }

        nextSpecialTime.textContent = formatDiff(diffSpecial);
        if (nextSpecial.name.includes('সেহরি')) {
            nextSpecialIcon.className = 'fas fa-utensils';
            nextSpecialName.textContent = nextSpecial.name + (nextSpecial.name.includes('আগামীকাল') ? '' : ' শুরু হতে');
        } else {
            nextSpecialIcon.className = 'fas fa-sunset';
            nextSpecialName.textContent = nextSpecial.name + ' শুরু হতে';
        }
    }

    // API call (হানাফী মাযহাবের জন্য school=1)
    async function fetchPrayerTimes(cityEn) {
        prayerContainer.innerHTML = `<div class="loader"></div>`;
        const today = new Date();
        const dateStr = `${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}`;
        // school=1 for Hanafi asr
        const url = `https://api.aladhan.com/v1/timingsByCity/${dateStr}?city=${encodeURIComponent(cityEn)}&country=Bangladesh&method=1&school=1`;

        try {
            const resp = await fetch(url);
            const data = await resp.json();
            if (data.code !== 200) throw new Error('Invalid response');

            const t = data.data.timings;
            const hijri = data.data.date.hijri;
            const hijriStr = `${hijri.day} ${hijri.month.en} ${hijri.year}`;
            updateDateDisplay(hijriStr);

            currentTimings = t;

            // ছয়টি কার্ড তৈরি (সেহরি, ফজর, যোহর, আসর, ইফতার, ইশা)
            const items = [
                { name: 'সেহরি', time: t.Imsak, icon: 'fa-utensils', special: true },
                { name: 'ফজর', time: t.Fajr, icon: 'fa-sun', special: false },
                { name: 'যোহর', time: t.Dhuhr, icon: 'fa-sun', special: false },
                { name: 'আসর', time: t.Asr, icon: 'fa-cloud-sun', special: false },
                { name: 'ইফতার', time: t.Maghrib, icon: 'fa-sunset', special: true },
                { name: 'ইশা', time: t.Isha, icon: 'fa-moon', special: false }
            ];

            let html = '<div class="prayer-grid">';
            items.forEach(it => {
                html += `<div class="prayer-block ${it.special ? 'special' : ''}">
                    <div class="prayer-name"><i class="fas ${it.icon}"></i> ${it.name}</div>
                    <div class="prayer-time">${it.time}</div>
                    <div class="prayer-note">${it.special ? (it.name === 'সেহরি' ? 'রোজা শুরুর শেষ সময়' : 'ইফতারের সময়') : ''}</div>
                </div>`;
            });
            html += '</div>';
            prayerContainer.innerHTML = html;

            // কাউন্টার চালু
            if (window.counterInterval) clearInterval(window.counterInterval);
            updateCounters();
            window.counterInterval = setInterval(updateCounters, 1000);

        } catch (err) {
            prayerContainer.innerHTML = `<div class="error-box"><i class="fas fa-exclamation-triangle"></i> সময় লোড হয়নি, জেলা সঠিক আছে কি?</div>`;
            console.warn(err);
            updateDateDisplay(null);
            currentTimings = null;
        }
    }

    // initial load with Dhaka
    window.addEventListener('load', function() {
        divSelect.value = 'Dhaka';
        divSelect.dispatchEvent(new Event('change'));
        setTimeout(() => {
            distSelect.value = 'Dhaka';
            distSelect.dispatchEvent(new Event('change'));
        }, 300);
    });
})();
</script>
</body>
</html>